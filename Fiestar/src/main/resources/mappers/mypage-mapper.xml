<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.TeamFiestar.Fiestar.mypage.mapper.MyPageMapper">

	<!-- 비밀번호 일치  -->
	<select id="selectMemberPw" resultType="string">
		SELECT MEMBER_PW FROM "MEMBER"
		WHERE MEMBER_NO = #{memberNo}
	</select>

	<!-- 회원 탈퇴 -->
	<update id="withdrawal">
		UPDATE "MEMBER" SET
		MEMBER_DEL_FL = 'Y'
		WHERE MEMBER_NO = #{memberNo}
	</update>

	<!-- 프로필 이미지 바꾸기 -->
	<update id="profile">
		UPDATE "MEMBER"
		SET MEMBER_PROFILE = #{memberProfile}
		WHERE MEMBER_NO = #{memberNo}
	</update>


	<!--내가 작성한 글 개수 -->
	<select id="listCount" resultType="_int">
		SELECT COUNT(*)
		FROM BOARD
		WHERE MEMBER_NO = #{memberNo}
		AND BOARD_DEL_FL = 'N'
	</select>

	<!--내가 작성한 글 조회-->
	<select id="selectMyFeedList" resultType="Board">
		SELECT MEMBER_NO, BOARD_CONTENT, BOARD_ENROLL_DATE, MEMBER_NICKNAME,
		MEMBER_PROFILE, BOARD_NO
		FROM BOARD
		JOIN MEMBER USING(MEMBER_NO)
		WHERE MEMBER_NO = #{memberNo}
		AND BOARD_DEL_FL = 'N'
	</select>


	<select id="commentCount" resultType="_int">
		SELECT COUNT(*)
		FROM
		(SELECT BOARD_COMMENT_NO AS COMMENT_NO,
		BOARD_COMMENT_CONTENT AS COMMENT_CONTENT ,
		BOARD_COMMENT_ENROLL_DATE AS COMMENT_ENROLL_DATE,
		(SELECT b.BOARD_CONTENT FROM BOARD b WHERE bc.BOARD_NO = b.BOARD_NO) AS
		PARENT_TITLE,
		'BOARD' AS COMMENT_TYPE
		FROM BOARD_COMMENT bc
		UNION
		SELECT MEDIA_COMMENT_NO AS COMMENT_NO,
		MEDIA_COMMENT_CONTENT AS COMMENT_CONTENT ,
		MEDIA_COMMENT_ENROLL_DATE AS COMMENT_ENROLL_DATE,
		(SELECT m.MEDIA_TITLE FROM MEDIA m WHERE mc.MEDIA_NO = m.MEDIA_NO) AS
		PARENT_TITLE,
		'MEDIA' AS COMMENT_TYPE
		FROM MEDIA_COMMENT mc
		) </select>

	<select id="MyCommentList" resultType="Comment">
		SELECT BOARD_COMMENT_NO AS COMMENT_NO,
		BOARD_COMMENT_CONTENT AS COMMENT_CONTENT ,
		BOARD_COMMENT_ENROLL_DATE AS COMMENT_ENROLL_DATE,
		(SELECT b.BOARD_CONTENT FROM BOARD b WHERE bc.BOARD_NO = b.BOARD_NO) AS
		PARENT_TITLE,
		'BOARD' AS COMMENT_TYPE
		FROM BOARD_COMMENT bc
		UNION
		SELECT MEDIA_COMMENT_NO AS COMMENT_NO,
		MEDIA_COMMENT_CONTENT AS COMMENT_CONTENT ,
		MEDIA_COMMENT_ENROLL_DATE AS COMMENT_ENROLL_DATE,
		(SELECT m.MEDIA_TITLE FROM MEDIA m WHERE mc.MEDIA_NO = m.MEDIA_NO) AS
		PARENT_TITLE,
		'MEDIA' AS COMMENT_TYPE
		FROM MEDIA_COMMENT mc
	</select>


	<select id="artistCount" resultType="_int">
		SELECT COUNT(*)
		FROM ARTIST_SUBSCRIBE
		WHERE MEMBER_NO = #{memberNo}
	</select>

	<select id="myArtistList" resultType="ArtistSubscribe">
		SELECT ARTIST_GROUP_NO, MEMBER_NO, ARTIST_GROUP_TITLE,
		ARTIST_GROUP_PROFILE
		FROM ARTIST_SUBSCRIBE
		JOIN ARTIST_GROUP USING( ARTIST_GROUP_NO)
		WHERE MEMBER_NO =#{memberNo}
	</select>

	<select id="purchaseCount" resultType="_int">
		SELECT COUNT(*)
		FROM PURCHASE_LIST
		JOIN PURCHASE USING (PURCHASE_NO)
		WHERE MEMBER_NO = #{memberNo}
	</select>

	<select id="myPurchaseList" resultType="PurchaseList">
		SELECT PURCHASE_LIST_NO ,PURCHASE_NO ,PRODUCT_NO ,PRODUCT_QUANTITY ,
		PURCHASE_LIST_NO, MEMBER_NO,
		PURCHASE_STATUS ,PURCHASE_DATE , PRODUCT_NAME, PRODUCT_IMAGE,
		PURCHASE_PRICE
		FROM PURCHASE_LIST
		JOIN PURCHASE p USING (PURCHASE_NO)
		JOIN PRODUCT p2 USING (PRODUCT_NO)
		WHERE MEMBER_NO = #{memberNo}
	</select>

<!--	<update id="deleteBoard">
		UPDATE "BOARD" SET
		BOARD_DEL_FL = 'Y'
		WHERE BOARD_NO = #{boardNo}
	</update>-->


</mapper>